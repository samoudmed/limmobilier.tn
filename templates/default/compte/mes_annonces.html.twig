{% extends 'base.html.twig' %}

{% block meta %}
    <title>Tunisie annonce immobilier mes annonces</title>
    <meta name="description" content="Mes Annonces immobilières en Tunisie sur limmobilier.tn. Achat, vente et location de biens immobiliers en Tunisie. Trouvez votre maison, appartement ou terrain" />
{% endblock %}

{% block body %}
    <section class="my-property">
        <div class="container">
            <ul class="ht-breadcrumbs ht-breadcrumbs--y-padding ht-breadcrumbs--b-border">
                <li class="ht-breadcrumbs__item"><a href="{{ path('homepage') }}" class="ht-breadcrumbs__link"><span class="ht-breadcrumbs__title">Accueil</span></a></li>
                <li class="ht-breadcrumbs__item"><span class="ht-breadcrumbs__page">Mes annonces</span></li>
            </ul><!-- ht-breadcrumb -->
        </div>
        <div class="container">
            <div class="my-property__container">
                <div class="row">
                    <div class="col-md-3">
                        {{ include("default/compte/_menuUser.html.twig") }}
                    </div>
                    <div class="col-md-9">
                        {% for label, messages in app.flashes %}
                            {% for message in messages %}
                                <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                                    <strong>{{ message }}</strong>
                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                            {% endfor %}
                        {% endfor %}
                        
                            <form id="filtreForm" action="{{ path('mes_annonces') }}" class="g-3" method="POST">
                                <div class="row padding-15">
                                    <div class="col-md-10">
                                        <input name="keyword" type="text" id="keyword" class="form-control" placeholder="Titre ou mot-clé">
                                    </div>
                                    <div class="col-md-2">
                                        <button type="submit" class="btn btn-primary w-100" onclick="filtrer()">Filtrer</button>
                                    </div>
                                </div>
                            </form>
                         
                        <ul class="manage-list manage-list--my-property">
                            {% for annonce in annonces %}
                                <li class="manage-list__item row mb-4 p-3 rounded">
                                    <!-- Colonne image -->
                                    <div class="col-12 col-md-4  mb-2 mb-md-0">
                                        <img src="{{ asset(annonce.photo is defined and annonce.photo ? '/uploads/photos/263x175/' ~ annonce.photo : 'images/default.jpg') }}"
                                             alt="Photo de l'annonce"
                                             class="img-fluid rounded w-100 h-100 object-fit-cover"
                                             style="min-height: 200px; object-fit: cover;">
                                    </div>
                                    <!-- Colonne détails + actions -->
                                    <div class="col-12 col-md-8 d-flex flex-column justify-content-between">
                                        <!-- Ligne d'information -->
                                        <div class="mb-3">
                                            <h5 class="mb-1"><a href="{{ path('annonce_details', { 'label' : annonce.label|slugify, 'id' : annonce.id }) }}">{{ annonce.label }}</a></h5>
                                            <p class="mb-1 text-muted">
                                                {{ annonce.kind }} à {{ annonce.delegation }} — 
                                                <strong>{{ annonce.prix|number_format(0, '.', ' ') }} TND</strong>
                                            </p>
                                            <p class="text-muted small mb-0">
                                                Publiée jusqu'au : {{ annonce.expiredAt|date('Y-m-d') }}
                                            </p>
                                        </div>

                                        <!-- Ligne actions -->
                                        <div class="d-flex justify-content-between align-items-center flex-wrap mt-2">
                                            {% if annonce.archived == 0 %}
                                                <div class="btn-group mb-2" role="group">
                                                    <a href="{{ path('annonce_update', { 'id' : annonce.id }) }}" class="btn btn-outline-primary btn-sm">
                                                        {# fa-pencil #}
                                                        <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1.25em; height:1em; vertical-align:-0.125em; margin-right:0.2em;"><path fill="currentColor" d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0z"></path></svg> Modifier
                                                    </a>
                                                    <a href="{{ path('annonce_published', { 'id' : annonce.id, 'statut' : annonce.isPublished ? 1 : 0 }) }}" class="btn btn-outline-warning btn-sm">
                                                        {% if annonce.isPublished == 0 %}
                                                            {# fa-folder-open #}
                                                            <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="width:1.25em; height:1em; vertical-align:-0.125em; margin-right:0.2em;"><path fill="currentColor" d="M569.2 201.8L445.5 158.2l-32.1-131.5c-4-16.3-19.3-27.5-35.8-23.5s-27.5 19.3-23.5 35.8l26.9 110.1L248.1 39.5c-11-12.4-28.9-15.3-43.1-7.8s-21 24.3-16.2 40.2l73.3 246.3-149.6-33.8C96.8 281.3 81 288.5 73.2 302s-5.4 30.5 5.1 42.5L288 512l267.9-166.1c11.9-7.3 16.6-22.1 11.2-35.9s-19.5-22.2-33.9-18.2z"></path></svg> Activer
                                                        {% else %}
                                                            {# fa-folder #}
                                                            <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width:1.25em; height:1em; vertical-align:-0.125em; margin-right:0.2em;"><path fill="currentColor" d="M464 128H272l-64-64H48C21.5 64 0 85.5 0 112v288c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V176c0-26.5-21.5-48-48-48z"></path></svg> Désactiver
                                                        {% endif %}
                                                    </a>
                                                    <a href="{{ path('annonce_delete', { 'id' : annonce.id }) }}" class="btn btn-outline-danger btn-sm" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cette annonce ?');">
                                                        {# fa-trash #}
                                                        <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="width:1.25em; height:1em; vertical-align:-0.125em; margin-right:0.2em;"><path fill="currentColor" d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.7 23.7 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32l21.2 339z"></path></svg> Supprimer
                                                    </a>
                                                </div>
                                            {% else %}
                                                <span class="badge badge-secondary">Archivé</span>
                                            {% endif %}

                                            <span class="text-muted small mb-2">
                                                {# fa-eye #}
                                                <svg aria-hidden="true" focusable="false" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="width:1.25em; height:1em; vertical-align:-0.125em; margin-right:0.2em;"><path fill="currentColor" d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></svg> {{ annonce.view }} vues
                                            </span>
                                        </div>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                        <div class="text-center mt-4">{{ knp_pagination_render(annonces) }}</div>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
