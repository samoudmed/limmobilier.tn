{% extends 'base.html.twig' %}

{# Page-specific title and description #}
{% block title %}D√©poser votre annonce immobili√®re gratuitement sur limmobilier.tn{% endblock %}
{% block meta_description %}Inscription ‚Äì inscrivez vous sur le site des annonces immobili√®re et d√©poser votre annonce immobili√®re en Tunisie gratuit, location, vente et achat{% endblock %}

{% block body %}
    <div class="container">
        {# Breadcrumbs styled with your .ht-breadcrumbs classes #}
        <ul class="ht-breadcrumbs ht-breadcrumbs--y-padding">
            <li class="ht-breadcrumbs__item">
                <a href="{{ path('homepage') }}" class="ht-breadcrumbs__link">
                    <span class="ht-breadcrumbs__title">Accueil</span>
                </a>
            </li>
            <li class="ht-breadcrumbs__item">
                <span class="ht-breadcrumbs__page">Inscription</span>
            </li>
        </ul>

        {# Main content section, centered using a simple row structure #}
        <div class="row" style="justify-content: center;">
            <div class="col-md-7"> {# Using a wider column for the form #}

                <div class="form-content"> {# A generic container for forms from your CSS #}
                    <h1 class="text-center">Inscription</h1>

                    {# Reusable flash message component #}
                    {% include 'default/_flash_messages.html.twig' %}
                    {{ form_start(registrationForm) }}
                    <div class="form-group">
                        <label for="registration_form_nom" class="form-label">Nom</label>
                        {{ form_widget(registrationForm.nom, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>
                    <div class="form-group">
                        <label for="registration_form_prenom" class="form-label">Pr√©nom</label>
                        {{ form_widget(registrationForm.prenom, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>
                    <div class="form-group">
                        <label for="registration_form_email" class="form-label">Email</label>
                        {{ form_widget(registrationForm.email, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>
                    <div class="form-group">
                        <label for="registration_form_plainPassword" class="form-label">Mot de passe</label>
                        {{ form_widget(registrationForm.plainPassword, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>
                    <div class="form-group">
                        <label for="registration_form_telephone" class="form-label">T√©l√©phone</label>
                        {{ form_widget(registrationForm.telephone, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>
                    <div class="form-group">
                        <label for="registration_form_type" class="form-label">Type de compte</label>
                        <div class="form-check">
                            {% for choice in registrationForm.type %}
                                {# R√©cup√©rer l'ID et la valeur #}
                                {% set id = choice.vars.id %}
                                {% set value = choice.vars.value %}
                                {% set checked = choice.vars.checked ? 'checked="checked"' : '' %}

                                <input type="radio"
                                    id="{{ id }}"
                                    name="{{ choice.vars.full_name }}"
                                    value="{{ value }}"
                                    class="main-listing__form-radio type"
                                    {{ checked }}>
                                <label for="{{ id }}" class="main-listing__form-label">
                                    {{ choice.vars.label }}
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registration_form_agence" class="form-label">Agence</label>
                        {{ form_widget(registrationForm.agence, {'attr': {'class': 'sign-up__field'}}) }}
                    </div>

                    {# Custom rendering for the file upload field #}
                    <div class="form-group">
                        <label for="registration_form_logo" class="form-label">Logo</label>
                        <div class="submit-property__upload">
                            {{ form_widget(registrationForm.logo) }}
                            <div class="submit-property__upload-inner">
                                <span class="submit-property__icon">üìÇ</span> {# Replaced with an emoji icon #}
                                <span class="submit-property__upload-desc">D√©poser le logo ici ou cliquer pour t√©l√©charger</span>
                            </div>
                        </div>
                        <div id="previewMultiImage" class="row" style="min-height:20px; margin-top: 1rem;"></div>
                        {{ form_errors(registrationForm.logo) }}
                    </div>

                    <div class="form-group">
                        <label  class="sign-up__label" for="registration_form_agreeTerms">{{ form_widget(registrationForm.agreeTerms, {'attr': {'class': 'opalmembership-input text input-text'}}) }} J'accepte les conditions g√©n√©rales et <a href="{{ path('confidentialites') }}" target="_blank">la politique de confidentialit√©</a></label>
                        <span class="help-block">{{ form_errors(registrationForm.agreeTerms) }}</span>
                    </div>

                    <div class="form-group text-center">
                        <input type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('registrationForm') }}">
                        <button type="submit" class="sign-up__submit">Inscription</button>
                    </div>
                   {{ form_end(registrationForm) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }} {# Include scripts from base.html.twig if any #}
    <script>
        // Ensure jQuery is loaded before this script runs
        $(document).ready(function () {
            $('#registration_form_logo').change(function () {
                var file = this.files[0];
                var allowedTypes = ["image/png", "image/jpeg", "image/gif"];

                if (!allowedTypes.includes(file.type)) {
                    alert("Please choose png, jpeg or gif files");
                    // Clear the file input if the type is wrong
                    $(this).val('');
                    return false;
                }

                var reader = new FileReader();

                reader.onload = function (e) {
                    // Clear previous preview before appending a new one
                    $('#previewMultiImage').html('<div class="col-md-3 margin"><img src="' + e.target.result + '" id="previewImage" class="img-fluid"></div>');
                    $(".submit-property__upload").hide();
                }

                reader.readAsDataURL(file);
            });
        });
    </script>
{% endblock %}